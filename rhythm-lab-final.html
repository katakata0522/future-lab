<html lang="ja"><head>



<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<title>ãƒªã‚ºãƒ ãƒ»ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚° Lab Ver.Final</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700;900&amp;display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@40,700,1,0" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
<style>
        body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            background-color: #FDF2F8; /* è–„ã„ãƒ”ãƒ³ã‚¯ */
            background-image: radial-gradient(#FBCFE8 2px, transparent 2px);
            background-size: 24px 24px;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(8px);
            border: 2px solid white;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        }

        @keyframes bounce-sm {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ */
        ::-webkit-scrollbar { height: 12px; }
        ::-webkit-scrollbar-track { background: rgba(0,0,0,0.05); border-radius: 6px; }
        ::-webkit-scrollbar-thumb { background: #DB2777; border-radius: 6px; border: 2px solid transparent; background-clip: content-box; }
        ::-webkit-scrollbar-thumb:hover { background: #BE185D; }
    </style>
<body class="text-slate-700 min-h-screen flex flex-col selection:bg-pink-200">
<!-- Header -->
<header class="bg-white border-b-4 border-pink-200 px-6 py-4 flex justify-between items-center z-20 shadow-sm sticky top-0">
<div class="flex items-center gap-3">
<div class="bg-pink-500 text-white p-2 rounded-2xl shadow-[0_4px_0_#be185d] transform -rotate-3">
<span class="material-symbols-rounded text-3xl block">piano</span>
</div>
<div>
<h1 class="text-xl md:text-2xl font-black tracking-wider text-slate-800">ãƒªã‚ºãƒ ãƒ»ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚° Lab</h1>
<p class="text-xs text-pink-500 font-bold">éŸ³ã®ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä¸¦ã¹ã¦éŸ³æ¥½ã‚’ä½œã‚ã†ï¼</p>
</div>
</div>
<div class="flex gap-2 md:gap-3">
<button class="bg-yellow-400 hover:bg-yellow-500 text-white px-3 py-2 md:px-4 md:py-2 rounded-2xl font-bold flex items-center gap-2 shadow-[0_4px_0_#ca8a04] active:shadow-none active:translate-y-1 transition-all" onclick="openHelp()">
<span class="material-symbols-rounded">help</span>
<span class="hidden md:inline">ã‚ãã³ã‹ãŸ</span>
</button>
<button class="bg-slate-800 hover:bg-slate-700 text-white px-3 py-2 md:px-4 md:py-2 rounded-2xl font-bold flex items-center gap-2 shadow-[0_4px_0_#1e293b] active:shadow-none active:translate-y-1 transition-all" onclick="downloadSource()">
<span class="material-symbols-rounded">save</span>
<span class="hidden md:inline">ä¿å­˜ã™ã‚‹</span>
</button>
</div>
</header>
<!-- Main Content -->
<main class="flex-1 w-full max-w-6xl mx-auto p-4 md:p-8 flex flex-col gap-6">
<!-- Top Controls Area -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<!-- Left: Player & Tempo -->
<div class="glass-panel p-6 rounded-3xl flex items-center gap-6 justify-center md:justify-start">
<button class="bg-pink-500 hover:bg-pink-600 text-white w-20 h-20 rounded-full shadow-[0_6px_0_#be185d] flex items-center justify-center transition-transform hover:scale-105 active:scale-95 active:shadow-none active:translate-y-1.5 flex-shrink-0" id="play-btn" onclick="togglePlay()">
<span class="material-symbols-rounded text-5xl ml-1" id="play-icon">play_arrow</span>
</button>
<div class="flex-1">
<div class="bg-white px-4 py-2 rounded-2xl border-2 border-slate-100 flex flex-col justify-center shadow-sm mb-3">
<span class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">ã¯ã‚„ã• (Tempo)</span>
<div class="flex items-center gap-3">
<span class="material-symbols-rounded text-slate-400">speed</span>
<input class="w-full accent-pink-500 cursor-pointer" max="240" min="60" oninput="updateTempo(this.value)" type="range" value="120">
<span class="font-mono font-bold text-xl text-pink-600 w-12 text-center" id="tempo-display">120</span>
</div>
</div>
<div class="flex justify-end">
<button class="text-xs font-bold text-slate-400 hover:text-red-500 flex items-center gap-1 transition px-2 py-1 rounded hover:bg-slate-100" onclick="clearBeats()">
<span class="material-symbols-rounded text-sm">delete</span> å…¨éƒ¨ã‘ã™
                        </button>
</div>
</div>
</div>
<!-- Right: Presets & Save -->
<div class="glass-panel p-6 rounded-3xl flex flex-col gap-4">
<!-- Presets -->
<div>
<span class="text-xs font-bold text-slate-400 uppercase tracking-widest block mb-2">ãŠæ‰‹æœ¬ãƒªã‚ºãƒ </span>
<div class="flex flex-wrap gap-2">
<button class="px-3 py-2 rounded-xl bg-blue-100 text-blue-600 font-bold hover:bg-blue-200 transition text-sm flex items-center gap-1" onclick="loadPreset('rock')">âš¡ï¸ 8ãƒ“ãƒ¼ãƒˆ</button>
<button class="px-3 py-2 rounded-xl bg-purple-100 text-purple-600 font-bold hover:bg-purple-200 transition text-sm flex items-center gap-1" onclick="loadPreset('dance')">ğŸ’ƒ ãƒ€ãƒ³ã‚¹</button>
<button class="px-3 py-2 rounded-xl bg-orange-100 text-orange-600 font-bold hover:bg-orange-200 transition text-sm flex items-center gap-1" onclick="loadPreset('hiphop')">ğŸ˜ ãƒ’ãƒƒãƒ—ãƒ›ãƒƒãƒ—</button>
<button class="px-3 py-2 rounded-xl bg-green-100 text-green-600 font-bold hover:bg-green-200 transition text-sm flex items-center gap-1" onclick="loadPreset('latin')">ğŸ ãƒ©ãƒ†ãƒ³</button>
</div>
</div>
<!-- Save Area -->
<div class="border-t-2 border-slate-100 pt-3">
<span class="text-xs font-bold text-pink-400 uppercase tracking-widest block mb-2">ãƒã‚¤ãƒ«ãƒ¼ãƒ  (ã¤ãã£ãŸãƒªã‚ºãƒ ã‚’ä¿å­˜)</span>
<div class="flex gap-2 mb-3">
<input class="flex-1 bg-white border-2 border-slate-200 rounded-xl px-3 py-2 text-sm font-bold focus:outline-none focus:border-pink-400" id="preset-name" placeholder="ãƒªã‚ºãƒ ã®ãªã¾ãˆ" type="text">
<button class="bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded-xl font-bold text-sm shadow-md active:scale-95 transition" onclick="saveUserPreset()">
                            ä¿å­˜
                        </button>
</div>
<div class="flex flex-wrap gap-2 max-h-24 overflow-y-auto" id="user-preset-list">
<span class="text-xs text-slate-400 italic py-1">ã¾ã ä¿å­˜ã•ã‚Œã¦ã„ã¾ã›ã‚“</span>
</div>
</div>
</div>
</div>
<!-- Sequencer Area (Maximized) -->
<div class="bg-slate-800 rounded-3xl shadow-2xl p-6 overflow-hidden relative flex-1 flex flex-col justify-center min-h-[400px]">
<div class="w-full overflow-x-auto">
<!-- å¹…ã‚’åºƒãå–ã‚‹ -->
<div class="min-w-[900px] mx-auto">
<!-- Time Indicators -->
<div class="flex gap-2 mb-3 pl-[100px]" id="step-indicators"><div class="w-8 h-2 md:w-10 rounded-full bg-slate-700 transition-colors flex-shrink-0 " id="ind-0"></div><div class="w-8 h-2 md:w-10 rounded-full bg-slate-700 transition-colors flex-shrink-0 " id="ind-1"></div><div class="w-8 h-2 md:w-10 rounded-full bg-slate-700 transition-colors flex-shrink-0 " id="ind-2"></div><div class="w-8 h-2 md:w-10 rounded-full bg-slate-700 transition-colors flex-shrink-0 mr-4" id="ind-3"></div><div class="w-8 h-2 md:w-10 rounded-full bg-slate-700 transition-colors flex-shrink-0 " id="ind-4"></div><div class="w-8 h-2 md:w-10 rounded-full bg-slate-700 transition-colors flex-shrink-0 " id="ind-5"></div><div class="w-8 h-2 md:w-10 rounded-full bg-slate-700 transition-colors flex-shrink-0 " id="ind-6"></div><div class="w-8 h-2 md:w-10 rounded-full bg-slate-700 transition-colors flex-shrink-0 mr-4" id="ind-7"></div><div class="w-8 h-2 md:w-10 rounded-full bg-slate-700 transition-colors flex-shrink-0 " id="ind-8"></div><div class="w-8 h-2 md:w-10 rounded-full bg-slate-700 transition-colors flex-shrink-0 " id="ind-9"></div><div class="w-8 h-2 md:w-10 rounded-full bg-slate-700 transition-colors flex-shrink-0 " id="ind-10"></div><div class="w-8 h-2 md:w-10 rounded-full bg-slate-700 transition-colors flex-shrink-0 mr-4" id="ind-11"></div><div class="w-8 h-2 md:w-10 rounded-full bg-slate-700 transition-colors flex-shrink-0 " id="ind-12"></div><div class="w-8 h-2 md:w-10 rounded-full bg-slate-700 transition-colors flex-shrink-0 " id="ind-13"></div><div class="w-8 h-2 md:w-10 rounded-full bg-slate-700 transition-colors flex-shrink-0 " id="ind-14"></div><div class="w-8 h-2 md:w-10 rounded-full bg-slate-700 transition-colors flex-shrink-0 " id="ind-15"></div></div>
<!-- Instrument Rows -->
<div class="space-y-3">
<!-- 1. Hi-Hat -->
<div class="flex items-center gap-3 bg-slate-700/30 p-2 rounded-xl border border-slate-700 hover:border-slate-600 transition group relative pr-12">
<div class="w-[80px] flex flex-col items-center justify-center text-yellow-400 cursor-help transition transform group-hover:scale-105" onclick="playOneShot('hihat')">
<span class="material-symbols-rounded text-3xl">album</span>
<span class="text-[10px] font-bold mt-1">ãƒã‚¤ãƒãƒƒãƒˆ</span>
</div>
<div class="flex gap-2 flex-1" id="row-hihat"><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="hihat" data-index="0"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="hihat" data-index="1"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="hihat" data-index="2"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 mr-4" data-type="hihat" data-index="3"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="hihat" data-index="4"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="hihat" data-index="5"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="hihat" data-index="6"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 mr-4" data-type="hihat" data-index="7"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="hihat" data-index="8"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="hihat" data-index="9"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="hihat" data-index="10"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 mr-4" data-type="hihat" data-index="11"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="hihat" data-index="12"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="hihat" data-index="13"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="hihat" data-index="14"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="hihat" data-index="15"></div></div>
<button class="absolute right-2 top-1/2 -translate-y-1/2 text-slate-500 hover:text-red-400 p-1.5 rounded hover:bg-slate-700 transition opacity-50 group-hover:opacity-100" onclick="clearRow('hihat')" title="ã“ã®åˆ—ã‚’æ¶ˆã™">
<span class="material-symbols-rounded">backspace</span>
</button>
</div>
<!-- 2. Clap -->
<div class="flex items-center gap-3 bg-slate-700/30 p-2 rounded-xl border border-slate-700 hover:border-slate-600 transition group relative pr-12">
<div class="w-[80px] flex flex-col items-center justify-center text-green-400 cursor-help transition transform group-hover:scale-105" onclick="playOneShot('clap')">
<span class="material-symbols-rounded text-3xl js-replaced-missing-icon">radio_button_unchecked</span>
<span class="text-[10px] font-bold mt-1">ã‚¯ãƒ©ãƒƒãƒ—</span>
</div>
<div class="flex gap-2 flex-1" id="row-clap"><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="clap" data-index="0"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="clap" data-index="1"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="clap" data-index="2"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 mr-4" data-type="clap" data-index="3"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="clap" data-index="4"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="clap" data-index="5"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="clap" data-index="6"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 mr-4" data-type="clap" data-index="7"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="clap" data-index="8"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="clap" data-index="9"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="clap" data-index="10"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 mr-4" data-type="clap" data-index="11"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="clap" data-index="12"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="clap" data-index="13"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="clap" data-index="14"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="clap" data-index="15"></div></div>
<button class="absolute right-2 top-1/2 -translate-y-1/2 text-slate-500 hover:text-red-400 p-1.5 rounded hover:bg-slate-700 transition opacity-50 group-hover:opacity-100" onclick="clearRow('clap')" title="ã“ã®åˆ—ã‚’æ¶ˆã™">
<span class="material-symbols-rounded">backspace</span>
</button>
</div>
<!-- 3. Snare -->
<div class="flex items-center gap-3 bg-slate-700/30 p-2 rounded-xl border border-slate-700 hover:border-slate-600 transition group relative pr-12">
<div class="w-[80px] flex flex-col items-center justify-center text-cyan-400 cursor-help transition transform group-hover:scale-105" onclick="playOneShot('snare')">
<span class="material-symbols-rounded text-3xl">adjust</span>
<span class="text-[10px] font-bold mt-1">ã‚¹ãƒã‚¢</span>
</div>
<div class="flex gap-2 flex-1" id="row-snare"><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="snare" data-index="0"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="snare" data-index="1"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="snare" data-index="2"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 mr-4" data-type="snare" data-index="3"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="snare" data-index="4"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="snare" data-index="5"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="snare" data-index="6"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 mr-4" data-type="snare" data-index="7"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="snare" data-index="8"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="snare" data-index="9"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="snare" data-index="10"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 mr-4" data-type="snare" data-index="11"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="snare" data-index="12"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="snare" data-index="13"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="snare" data-index="14"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="snare" data-index="15"></div></div>
<button class="absolute right-2 top-1/2 -translate-y-1/2 text-slate-500 hover:text-red-400 p-1.5 rounded hover:bg-slate-700 transition opacity-50 group-hover:opacity-100" onclick="clearRow('snare')" title="ã“ã®åˆ—ã‚’æ¶ˆã™">
<span class="material-symbols-rounded">backspace</span>
</button>
</div>
<!-- 4. Tom -->
<div class="flex items-center gap-3 bg-slate-700/30 p-2 rounded-xl border border-slate-700 hover:border-slate-600 transition group relative pr-12">
<div class="w-[80px] flex flex-col items-center justify-center text-purple-400 cursor-help transition transform group-hover:scale-105" onclick="playOneShot('tom')">
<span class="material-symbols-rounded text-3xl">trip_origin</span>
<span class="text-[10px] font-bold mt-1">ã‚¿ãƒ </span>
</div>
<div class="flex gap-2 flex-1" id="row-tom"><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="tom" data-index="0"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="tom" data-index="1"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="tom" data-index="2"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 mr-4" data-type="tom" data-index="3"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="tom" data-index="4"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="tom" data-index="5"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="tom" data-index="6"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 mr-4" data-type="tom" data-index="7"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="tom" data-index="8"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="tom" data-index="9"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="tom" data-index="10"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 mr-4" data-type="tom" data-index="11"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="tom" data-index="12"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="tom" data-index="13"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="tom" data-index="14"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="tom" data-index="15"></div></div>
<button class="absolute right-2 top-1/2 -translate-y-1/2 text-slate-500 hover:text-red-400 p-1.5 rounded hover:bg-slate-700 transition opacity-50 group-hover:opacity-100" onclick="clearRow('tom')" title="ã“ã®åˆ—ã‚’æ¶ˆã™">
<span class="material-symbols-rounded">backspace</span>
</button>
</div>
<!-- 5. Kick -->
<div class="flex items-center gap-3 bg-slate-700/30 p-2 rounded-xl border border-slate-700 hover:border-slate-600 transition group relative pr-12">
<div class="w-[80px] flex flex-col items-center justify-center text-pink-400 cursor-help transition transform group-hover:scale-105" onclick="playOneShot('kick')">
<span class="material-symbols-rounded text-3xl">circle</span>
<span class="text-[10px] font-bold mt-1">ãƒã‚¹ãƒ‰ãƒ©ãƒ </span>
</div>
<div class="flex gap-2 flex-1" id="row-kick"><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="kick" data-index="0"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="kick" data-index="1"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="kick" data-index="2"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 mr-4" data-type="kick" data-index="3"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="kick" data-index="4"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="kick" data-index="5"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="kick" data-index="6"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 mr-4" data-type="kick" data-index="7"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="kick" data-index="8"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="kick" data-index="9"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="kick" data-index="10"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 mr-4" data-type="kick" data-index="11"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="kick" data-index="12"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="kick" data-index="13"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="kick" data-index="14"></div><div class="w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 " data-type="kick" data-index="15"></div></div>
<button class="absolute right-2 top-1/2 -translate-y-1/2 text-slate-500 hover:text-red-400 p-1.5 rounded hover:bg-slate-700 transition opacity-50 group-hover:opacity-100" onclick="clearRow('kick')" title="ã“ã®åˆ—ã‚’æ¶ˆã™">
<span class="material-symbols-rounded">backspace</span>
</button>
</div>
</div>
</div>
</div>
<!-- Hint -->
<div class="mt-4 text-center">
<p class="text-slate-400 text-sm font-bold flex items-center justify-center gap-2">
<span class="material-symbols-rounded text-yellow-400 text-base animate-bounce-sm">lightbulb</span>
                    ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã§è©¦è´ã€å³ã®<span class="material-symbols-rounded text-sm bg-slate-600 px-1 rounded">backspace</span>ã§åˆ—ã‚’ã‚¯ãƒªã‚¢
                </p>
</div>
</div>
</main>
<!-- Help Modal -->
<div class="fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-50 flex items-center justify-center p-4 transition-opacity duration-300 hidden opacity-0" id="help-modal">
<div class="bg-white w-full max-w-md rounded-3xl shadow-2xl overflow-hidden transform transition-all scale-95" id="help-content">
<div class="bg-yellow-400 p-4 flex justify-between items-center">
<h2 class="text-xl font-black text-white flex items-center gap-2">
<span class="material-symbols-rounded">school</span>
                    ã‚ãã³ã‹ãŸ
                </h2>
<button class="bg-white/20 hover:bg-white/40 text-white rounded-full p-1 transition" onclick="closeHelp()">
<span class="material-symbols-rounded">close</span>
</button>
</div>
<div class="p-6 space-y-6 overflow-y-auto max-h-[70vh]">
<div class="flex gap-4 items-start">
<div class="bg-pink-100 text-pink-600 w-8 h-8 rounded-full flex items-center justify-center font-black text-lg flex-shrink-0">1</div>
<div>
<h3 class="text-lg font-bold text-slate-800 mb-1">éŸ³ã®ãƒ–ãƒ­ãƒƒã‚¯ã‚’ç½®ã</h3>
<p class="text-sm text-slate-600">
                            æš—ã„ãƒã‚¹ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨éŸ³ãŒé³´ã‚Šã¾ã™ã€‚å³å´ã® <span class="material-symbols-rounded text-sm align-middle bg-slate-200 p-0.5 rounded text-slate-500">backspace</span> ã§ãã®åˆ—ã ã‘æ¶ˆã›ã¾ã™ã€‚
                        </p>
</div>
</div>
<div class="flex gap-4 items-start">
<div class="bg-blue-100 text-blue-600 w-8 h-8 rounded-full flex items-center justify-center font-black text-lg flex-shrink-0">2</div>
<div>
<h3 class="text-lg font-bold text-slate-800 mb-1">ä¿å­˜æ©Ÿèƒ½</h3>
<p class="text-sm text-slate-600">
                            åå‰ã‚’ã¤ã‘ã¦ã€Œä¿å­˜ã€ãƒœã‚¿ãƒ³ã§ä¸€è¦§ã«è¿½åŠ ã€‚<br>
<span class="text-red-500 font-bold">å³ä¸Šã®ã€Œä¿å­˜ã™ã‚‹ã€ãƒœã‚¿ãƒ³ã§ãƒ‘ã‚½ã‚³ãƒ³ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ã€‚</span>
</p>
</div>
</div>
<div class="bg-slate-50 p-4 flex justify-center">
<button class="bg-pink-500 hover:bg-pink-600 text-white px-6 py-2 rounded-xl font-bold shadow-sm active:translate-y-0.5 transition w-full" onclick="closeHelp()">
                        ã‚ã‹ã£ãŸï¼
                    </button>
</div>
</div>
</div>
</div>
<script>
        // --- UTILS ---
        function downloadSource() {
            const html = document.documentElement.outerHTML;
            const blob = new Blob([html], { type: 'text/html' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'rhythm-lab-final.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        // --- HELP MODAL ---
        const modal = document.getElementById('help-modal');
        const modalContent = document.getElementById('help-content');

        function openHelp() {
            modal.classList.remove('hidden');
            void modal.offsetWidth;
            modal.classList.remove('opacity-0');
            modalContent.classList.remove('scale-95');
            modalContent.classList.add('scale-100');
        }

        function closeHelp() {
            modal.classList.add('opacity-0');
            modalContent.classList.remove('scale-100');
            modalContent.classList.add('scale-95');
            setTimeout(() => { modal.classList.add('hidden'); }, 300);
        }

        // è‡ªå‹•ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã¯å‰Šé™¤ã—ã¾ã—ãŸ

        // --- AUDIO ENGINE ---
        const STEPS = 16;
        let isPlaying = false;
        let currentStep = 0;
        let tempo = 120;
        
        const INSTRUMENTS = ['hihat', 'clap', 'snare', 'tom', 'kick'];
        
        let grid = {
            hihat: new Array(STEPS).fill(0),
            clap:  new Array(STEPS).fill(0),
            snare: new Array(STEPS).fill(0),
            tom:   new Array(STEPS).fill(0),
            kick:  new Array(STEPS).fill(0)
        };

        let synths = {};
        let isAudioInit = false;

        async function initAudio() {
            if(isAudioInit) return;
            await Tone.start();
            
            synths.kick = new Tone.MembraneSynth({ pitchDecay: 0.05, octaves: 10, oscillator: { type: "sine" }, envelope: { attack: 0.001, decay: 0.4, sustain: 0.01, release: 1.4, attackCurve: "exponential" } }).toDestination();
            synths.kick.volume.value = 0;

            synths.snare = new Tone.NoiseSynth({ noise: { type: 'white' }, envelope: { attack: 0.005, decay: 0.1, sustain: 0 } }).toDestination();
            synths.snare.volume.value = -8;

            synths.hihat = new Tone.MetalSynth({ frequency: 200, envelope: { attack: 0.001, decay: 0.1, release: 0.01 }, harmonicity: 5.1, modulationIndex: 32, resonance: 4000, octaves: 1.5 }).toDestination();
            synths.hihat.volume.value = -15;

            synths.clap = new Tone.NoiseSynth({ noise: { type: 'pink' }, envelope: { attack: 0.001, decay: 0.1, sustain: 0 } }).toDestination();
            synths.clap.volume.value = -10;

            synths.tom = new Tone.MembraneSynth({ pitchDecay: 0.05, octaves: 4, oscillator: { type: "sine" }, envelope: { attack: 0.001, decay: 0.2, sustain: 0, release: 1 } }).toDestination();
            synths.tom.volume.value = -5;

            isAudioInit = true;
        }

        function playOneShot(type) {
            initAudio().then(() => {
                if(type === 'kick') synths.kick.triggerAttackRelease("C1", "8n");
                if(type === 'snare') synths.snare.triggerAttackRelease("8n");
                if(type === 'hihat') synths.hihat.triggerAttackRelease("32n");
                if(type === 'clap') synths.clap.triggerAttackRelease("8n");
                if(type === 'tom') synths.tom.triggerAttackRelease("G2", "8n");
            });
        }

        // --- UI & LOGIC (Maximized in Box) ---
        function initGrid() {
            const indicators = document.getElementById('step-indicators');
            indicators.innerHTML = '';
            INSTRUMENTS.forEach(inst => {
                document.getElementById(`row-${inst}`).innerHTML = '';
            });

            const createCell = (type, idx) => {
                const div = document.createElement('div');
                // 4æ‹ã”ã¨ã®ãƒãƒ¼ã‚¸ãƒ³ã‚’å¤§ãã‚ã«
                const marginClass = (idx + 1) % 4 === 0 && idx !== 15 ? 'mr-4' : '';
                // ã‚µã‚¤ã‚ºã‚’æœ€å¤§åŒ– (w-10 h-14 ç¨‹åº¦)
                div.className = `w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 ${marginClass}`;
                div.dataset.type = type;
                div.dataset.index = idx;
                div.onclick = () => toggleNote(type, idx, div);
                return div;
            };
            
            for(let i=0; i<STEPS; i++) {
                const marginClass = (i + 1) % 4 === 0 && i !== 15 ? 'mr-4' : '';
                const ind = document.createElement('div');
                // ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚‚å¤§ãã
                ind.className = `w-8 h-2 md:w-10 rounded-full bg-slate-700 transition-colors flex-shrink-0 ${marginClass}`;
                ind.id = `ind-${i}`;
                indicators.appendChild(ind);

                INSTRUMENTS.forEach(inst => {
                    document.getElementById(`row-${inst}`).appendChild(createCell(inst, i));
                });
            }
        }

        function toggleNote(type, idx, el) {
            initAudio();
            grid[type][idx] = grid[type][idx] ? 0 : 1;
            renderCell(type, idx, el);
            if(grid[type][idx]) playOneShot(type);
        }

        function renderCell(type, idx, el) {
            const isActive = grid[type][idx];
            const colors = { 
                kick: 'bg-pink-500 border-pink-400 shadow-[0_0_10px_#ec4899]', 
                snare: 'bg-cyan-500 border-cyan-400 shadow-[0_0_10px_#06b6d4]', 
                hihat: 'bg-yellow-400 border-yellow-300 shadow-[0_0_10px_#eab308]',
                clap: 'bg-green-500 border-green-400 shadow-[0_0_10px_#22c55e]',
                tom: 'bg-purple-500 border-purple-400 shadow-[0_0_10px_#a855f7]'
            };
            const marginClass = (idx + 1) % 4 === 0 && idx !== 15 ? 'mr-4' : '';
            
            if(isActive) {
                el.className = `w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border scale-105 ${colors[type]} flex-shrink-0 ${marginClass}`;
            } else {
                el.className = `w-8 h-10 md:w-10 md:h-14 rounded-lg cursor-pointer transition-all duration-100 border border-slate-600 bg-slate-900 hover:bg-slate-700 flex-shrink-0 ${marginClass}`;
            }
        }

        function updateAllCells() {
            INSTRUMENTS.forEach(type => {
                for(let i=0; i<STEPS; i++) {
                    const el = document.querySelector(`div[data-type="${type}"][data-index="${i}"]`);
                    renderCell(type, i, el);
                }
            });
        }

        function clearRow(type) {
            grid[type].fill(0);
            for(let i=0; i<STEPS; i++) {
                const el = document.querySelector(`div[data-type="${type}"][data-index="${i}"]`);
                renderCell(type, i, el);
            }
        }

        // --- PLAYBACK ---
        function togglePlay() {
            initAudio().then(() => {
                isPlaying = !isPlaying;
                const icon = document.getElementById('play-icon');
                const btn = document.getElementById('play-btn');

                if(isPlaying) {
                    icon.textContent = 'stop';
                    icon.className = "material-symbols-rounded text-5xl"; 
                    btn.className = "bg-slate-700 hover:bg-slate-800 text-white w-20 h-20 rounded-full shadow-inner flex items-center justify-center transition-transform scale-95 flex-shrink-0";
                    
                    Tone.Transport.bpm.value = tempo;
                    Tone.Transport.scheduleRepeat(playStep, "16n");
                    Tone.Transport.start();
                } else {
                    icon.textContent = 'play_arrow';
                    icon.className = "material-symbols-rounded text-5xl ml-1";
                    btn.className = "bg-pink-500 hover:bg-pink-600 text-white w-20 h-20 rounded-full shadow-[0_6px_0_#be185d] flex items-center justify-center transition-transform hover:scale-105 active:scale-95 active:shadow-none active:translate-y-1.5 flex-shrink-0";
                    
                    Tone.Transport.stop();
                    Tone.Transport.cancel();
                    currentStep = 0;
                    resetVisuals();
                }
            });
        }

        function playStep(time) {
            Tone.Draw.schedule(() => { updateStepVisuals(currentStep); }, time);

            if(grid.kick[currentStep]) synths.kick.triggerAttackRelease("C1", "8n", time);
            if(grid.snare[currentStep]) synths.snare.triggerAttackRelease("8n", time);
            if(grid.hihat[currentStep]) synths.hihat.triggerAttackRelease("32n", time);
            if(grid.clap[currentStep]) synths.clap.triggerAttackRelease("8n", time);
            if(grid.tom[currentStep]) synths.tom.triggerAttackRelease("G2", "8n", time);

            currentStep = (currentStep + 1) % STEPS;
        }

        function updateStepVisuals(step) {
            const prev = (step - 1 + STEPS) % STEPS;
            const prevEl = document.getElementById(`ind-${prev}`);
            const prevMargin = (prev + 1) % 4 === 0 && prev !== 15 ? 'mr-4' : '';
            if(prevEl) prevEl.className = `w-8 h-2 md:w-10 rounded-full bg-slate-700 transition-colors flex-shrink-0 ${prevMargin}`;

            const currEl = document.getElementById(`ind-${step}`);
            const currMargin = (step + 1) % 4 === 0 && step !== 15 ? 'mr-4' : '';
            if(currEl) currEl.className = `w-8 h-2 md:w-10 rounded-full bg-white shadow-[0_0_10px_white] scale-110 flex-shrink-0 ${currMargin}`;
        }

        function resetVisuals() {
            for(let i=0; i<STEPS; i++) {
                const el = document.getElementById(`ind-${i}`);
                const margin = (i + 1) % 4 === 0 && i !== 15 ? 'mr-4' : '';
                el.className = `w-8 h-2 md:w-10 rounded-full bg-slate-700 transition-colors flex-shrink-0 ${margin}`;
            }
        }

        function updateTempo(val) {
            tempo = val;
            document.getElementById('tempo-display').textContent = val;
            if(isPlaying) Tone.Transport.bpm.rampTo(val, 0.1);
        }

        // --- PRESETS ---
        const PRESETS = {
            rock: {
                kick: [1,0,0,0, 0,0,1,0, 1,0,0,0, 0,0,1,0],
                snare:[0,0,0,0, 1,0,0,0, 0,0,0,0, 1,0,0,0],
                hihat:[1,0,1,0, 1,0,1,0, 1,0,1,0, 1,0,1,1],
                clap: [0,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,0],
                tom:  [0,0,0,0, 0,0,0,0, 0,0,0,0, 0,1,0,0]
            },
            dance: {
                kick: [1,0,0,0, 1,0,0,0, 1,0,0,0, 1,0,0,0],
                snare:[0,0,0,0, 1,0,0,0, 0,0,0,0, 1,0,0,0],
                hihat:[0,0,1,0, 0,0,1,0, 0,0,1,0, 0,0,1,0],
                clap: [0,0,0,0, 1,0,0,0, 0,0,0,0, 1,0,0,0],
                tom:  [0,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,1,0]
            },
            hiphop: {
                kick: [1,0,0,0, 0,0,1,0, 0,0,1,1, 0,0,0,0],
                snare:[0,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,0],
                hihat:[1,0,1,0, 1,0,1,0, 1,0,0,1, 1,0,1,0],
                clap: [0,0,0,0, 1,0,0,0, 0,0,0,0, 1,0,0,0],
                tom:  [0,0,0,0, 0,0,0,0, 0,0,1,0, 0,1,0,0]
            },
            latin: {
                kick: [1,0,0,1, 0,0,1,0, 1,0,0,1, 0,0,1,0],
                snare:[0,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,0],
                hihat:[1,0,1,0, 1,0,1,0, 1,0,1,0, 1,0,1,0],
                clap: [0,0,1,0, 0,0,1,0, 0,0,1,0, 0,0,0,0],
                tom:  [1,0,0,0, 0,1,0,0, 1,0,0,0, 0,0,0,1]
            }
        };

        let userPresets = [];

        function loadPreset(name) {
            initAudio();
            const p = PRESETS[name];
            if(!p) return;
            applyGrid(p);
            playOneShot('hihat');
        }

        function loadUserPreset(idx) {
            initAudio();
            const p = userPresets[idx].data;
            applyGrid(p);
            playOneShot('hihat');
        }

        function applyGrid(p) {
            INSTRUMENTS.forEach(inst => {
                grid[inst] = p[inst] ? [...p[inst]] : new Array(STEPS).fill(0);
            });
            updateAllCells();
        }

        function clearBeats() {
            INSTRUMENTS.forEach(inst => grid[inst].fill(0));
            updateAllCells();
        }

        function saveUserPreset() {
            const nameInput = document.getElementById('preset-name');
            const name = nameInput.value.trim() || `ãƒªã‚ºãƒ  ${userPresets.length + 1}`;
            
            const currentData = {};
            INSTRUMENTS.forEach(inst => {
                currentData[inst] = [...grid[inst]];
            });

            userPresets.push({ name: name, data: currentData });
            nameInput.value = '';
            renderUserPresetList();
            playOneShot('clap');
        }

        function renderUserPresetList() {
            const container = document.getElementById('user-preset-list');
            if(userPresets.length === 0) {
                container.innerHTML = '<span class="text-xs text-slate-400 italic py-1">ã¾ã ä¿å­˜ã•ã‚Œã¦ã„ã¾ã›ã‚“</span>';
                return;
            }
            
            container.innerHTML = '';
            userPresets.forEach((p, idx) => {
                const btn = document.createElement('button');
                btn.className = "px-3 py-1 bg-white border border-slate-200 rounded-lg text-xs font-bold text-slate-600 hover:bg-pink-50 hover:border-pink-300 hover:text-pink-500 transition flex items-center gap-1 whitespace-nowrap";
                btn.innerHTML = `<span class="material-symbols-rounded text-xs">music_note</span> ${p.name}`;
                btn.onclick = () => loadUserPreset(idx);
                container.appendChild(btn);
            });
        }

        initGrid();

    </script>

</body></html>