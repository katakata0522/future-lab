<html lang="ja"><head>

<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<title>(4:56) Focus Studio</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;500;700;800&amp;family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,1,0" rel="stylesheet">
<script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"M PLUS Rounded 1c"', 'sans-serif'],
                    },
                    colors: {
                        kawaii: {
                            bg: '#fff0f5', 
                            primary: '#ff9eb5', 
                            primaryDark: '#ff7b9c',
                            secondary: '#ffd1d1',
                            accent: '#cdf0ea', 
                            text: '#5e4b52', 
                            dark: '#4a3b40',
                        }
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'bounce-slight': 'bounceSlight 2s infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        bounceSlight: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' },
                        }
                    }
                }
            }
        }
    </script>
<style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #ff9eb5; border-radius: 10px; }
        
        /* Glassmorphism */
        .glass {
            background: rgba(255, 255, 255, 0.65);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 2px solid rgba(255, 255, 255, 0.9);
            box-shadow: 0 8px 32px 0 rgba(255, 158, 181, 0.15);
        }
        
        .timer-btn-active {
            background-color: #ff9eb5;
            color: white;
            box-shadow: 0 4px 12px rgba(255, 158, 181, 0.4);
            transform: scale(1.05);
            border-color: transparent;
        }

        .break-btn-active {
            background-color: #cdf0ea;
            color: #115e59; 
            box-shadow: 0 4px 12px rgba(20, 184, 166, 0.2);
            transform: scale(1.05);
            border-color: transparent;
        }
        
        .preset-btn-active {
            background-color: white;
            border-color: #ff9eb5;
            color: #ff7b9c;
            box-shadow: 0 0 0 2px #ffc1d0;
        }

        .progress-ring__circle {
            transition: stroke-dashoffset 0.35s;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }

        .task-input-header {
            background: rgba(255,255,255,0.6);
            border: 2px solid white;
            transition: all 0.3s ease;
        }
        .task-input-header:focus {
            background: white;
            border-color: #ff9eb5;
            box-shadow: 0 0 0 3px rgba(255, 158, 181, 0.2);
        }
    </style>
<body class="bg-kawaii-bg text-kawaii-text min-h-screen relative overflow-x-hidden flex flex-col font-sans">
<!-- Background Decoration -->
<div class="fixed inset-0 z-0 pointer-events-none overflow-hidden">
<div class="absolute top-[-10%] left-[-10%] w-[500px] h-[500px] bg-pink-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-float"></div>
<div class="absolute bottom-[-10%] right-[-10%] w-[500px] h-[500px] bg-blue-100 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-float" style="animation-delay: 2s"></div>
</div>
<!-- Header -->
<header class="relative z-20 px-4 py-4 md:px-8 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
<!-- Logo Area -->
<div class="flex items-center gap-3">
<div class="w-12 h-12 bg-white rounded-2xl flex items-center justify-center text-kawaii-primary shadow-md rotate-3 border-2 border-white flex-shrink-0">
<span class="material-symbols-rounded text-3xl">timer</span>
</div>
<div>
<h1 class="text-xl md:text-2xl font-extrabold tracking-tight text-kawaii-dark">Focus Studio</h1>
</div>
</div>
<!-- Top Right Controls & Memo -->
<div class="flex flex-col items-end gap-2 w-full md:w-auto">
</div>
<button class="bg-white hover:bg-kawaii-primary hover:text-white text-kawaii-primary w-10 h-10 rounded-full flex items-center justify-center shadow-md transition-all relative group flex-shrink-0" onclick="toggleSoundDrawer()">
<span class="material-symbols-rounded text-xl group-hover:animate-bounce-slight">tune</span>
<span class="absolute top-0 right-0 w-3 h-3 bg-green-400 rounded-full border-2 border-white hidden" id="sound-badge"></span>
</button>
<button class="bg-white/50 hover:bg-white text-kawaii-text w-10 h-10 rounded-full transition-colors flex items-center justify-center flex-shrink-0" onclick="downloadApp()" title="‰øùÂ≠ò">
<span class="material-symbols-rounded text-xl">download</span>
</button>
</div>
<!-- ToDo Input -->
<div class="w-full md:w-96 relative group">
<input class="task-input-header w-full rounded-xl px-4 py-2 text-sm md:text-base font-bold text-kawaii-dark placeholder-kawaii-text/40 outline-none shadow-sm text-left pl-10" id="task-input" placeholder="‚ú® ÈÅîÊàê„Åó„Åü„ÅÑÁõÆÊ®ô„ÇÑ„É°„É¢„ÇíÂÖ•Âäõ..." type="text">
<div class="absolute left-3 top-1/2 transform -translate-y-1/2 opacity-40 group-hover:opacity-100 transition-opacity pointer-events-none">
<span class="material-symbols-rounded text-kawaii-primary text-xl">edit_note</span>
</div>
</div>
</div>
</header>
<!-- Main Content Area -->
<main class="relative z-10 flex-grow flex flex-col md:flex-row items-center justify-center px-4 md:px-12 gap-8 md:gap-16 py-4">
<!-- Left Panel: Settings -->
<div class="glass p-6 rounded-[2rem] shadow-xl w-full max-w-sm flex-shrink-0 order-2 md:order-1">
<!-- 1. Presets -->
<div class="mb-6">
<h2 class="text-xs font-bold text-kawaii-text/60 mb-2 uppercase tracking-wider flex items-center gap-1">
<span class="material-symbols-rounded text-sm js-replaced-missing-icon">radio_button_unchecked</span>
                „Åä„Åô„Åô„ÇÅ„Éó„É™„Çª„ÉÉ„Éà
            </h2>
<div class="grid grid-cols-3 gap-2">
<button class="preset-btn bg-white/50 hover:bg-white border-2 border-transparent rounded-xl p-2 text-center transition-all group" onclick="applyPreset(25, 5, this)">
<div class="text-kawaii-primary font-black text-lg group-hover:scale-110 transition-transform">25<span class="text-[10px] text-kawaii-text font-normal">+5</span></div>
<div class="text-[10px] text-kawaii-text/60 font-bold">Standard</div>
</button>
<button class="preset-btn bg-white/50 hover:bg-white border-2 border-transparent rounded-xl p-2 text-center transition-all group" onclick="applyPreset(50, 10, this)">
<div class="text-kawaii-primary font-black text-lg group-hover:scale-110 transition-transform">50<span class="text-[10px] text-kawaii-text font-normal">+10</span></div>
<div class="text-[10px] text-kawaii-text/60 font-bold">Deep</div>
</button>
<button class="preset-btn bg-white/50 hover:bg-white border-2 border-transparent rounded-xl p-2 text-center transition-all group" onclick="applyPreset(60, 15, this)">
<div class="text-kawaii-primary font-black text-lg group-hover:scale-110 transition-transform">60<span class="text-[10px] text-kawaii-text font-normal">+15</span></div>
<div class="text-[10px] text-kawaii-text/60 font-bold">Long</div>
</button>
</div>
</div>
<div class="border-t border-kawaii-text/10 mb-6"></div>
<!-- 2. Manual Focus Settings -->
<div class="mb-6">
<div class="flex items-center gap-2 mb-2 text-kawaii-dark font-bold text-sm">
<span class="material-symbols-rounded text-base text-orange-400">local_fire_department</span>
<span>ÈõÜ‰∏≠ (ÂàÜ)</span>
</div>
<div class="grid grid-cols-4 gap-2">
<button class="timer-preset aspect-square rounded-xl font-bold shadow-sm hover:border-kawaii-primary/50 border-2 border-transparent transition-all flex items-center justify-center timer-btn-active bg-kawaii-primary text-white shadow-lg scale-105" onclick="setTimer(5, 'focus')">5</button>
<button class="timer-preset aspect-square rounded-xl bg-white text-kawaii-text font-bold shadow-sm hover:border-kawaii-primary/50 border-2 border-transparent transition-all flex items-center justify-center" onclick="setTimer(10, 'focus')">10</button>
<button class="timer-preset aspect-square rounded-xl bg-white text-kawaii-text font-bold shadow-sm hover:border-kawaii-primary/50 border-2 border-transparent transition-all flex items-center justify-center" onclick="setTimer(15, 'focus')">15</button>
<button class="timer-preset aspect-square rounded-xl font-bold shadow-md transform border-2 border-transparent transition-all flex items-center justify-center bg-white text-kawaii-text" onclick="setTimer(25, 'focus')">25</button>
<button class="timer-preset aspect-square rounded-xl bg-white text-kawaii-text font-bold shadow-sm hover:border-kawaii-primary/50 border-2 border-transparent transition-all flex items-center justify-center" onclick="setTimer(30, 'focus')">30</button>
<button class="timer-preset aspect-square rounded-xl bg-white text-kawaii-text font-bold shadow-sm hover:border-kawaii-primary/50 border-2 border-transparent transition-all flex items-center justify-center" onclick="setTimer(45, 'focus')">45</button>
<button class="timer-preset aspect-square rounded-xl bg-white text-kawaii-text font-bold shadow-sm hover:border-kawaii-primary/50 border-2 border-transparent transition-all flex items-center justify-center" onclick="setTimer(50, 'focus')">50</button>
<button class="timer-preset aspect-square rounded-xl bg-white text-kawaii-text font-bold shadow-sm hover:border-kawaii-primary/50 border-2 border-transparent transition-all flex items-center justify-center" onclick="setTimer(60, 'focus')">60</button>
</div>
</div>
<!-- 3. Manual Break Settings -->
<div>
<div class="flex items-center gap-2 mb-2 text-kawaii-dark font-bold text-sm">
<span class="material-symbols-rounded text-base text-teal-500">coffee</span>
<span>‰ºëÊÜ© (ÂàÜ)</span>
</div>
<div class="grid grid-cols-3 gap-2">
<button class="timer-preset py-3 rounded-xl bg-kawaii-accent/40 text-teal-800 font-bold hover:bg-kawaii-accent transition-all border border-transparent text-sm break-btn-active" onclick="setTimer(5, 'break', true)">5ÂàÜ</button>
<button class="timer-preset py-3 rounded-xl bg-kawaii-accent/40 text-teal-800 font-bold hover:bg-kawaii-accent transition-all border border-transparent text-sm" onclick="setTimer(10, 'break', true)">10ÂàÜ</button>
<button class="timer-preset py-3 rounded-xl bg-kawaii-accent/40 text-teal-800 font-bold hover:bg-kawaii-accent transition-all border border-transparent text-sm" onclick="setTimer(15, 'break', true)">15ÂàÜ</button>
</div>
</div>
<div class="mt-6 pt-4 border-t border-kawaii-text/10 text-center">
<button class="text-xs font-bold text-kawaii-text/60 hover:text-kawaii-primary transition-colors flex items-center justify-center gap-2 mx-auto" onclick="document.getElementById('rsvp-modal').classList.remove('hidden')">
<span class="material-symbols-rounded text-sm">menu_book</span>
                    Áû¨Ë™≠„Éà„É¨„Éº„Éä„Éº„ÇíÈñã„Åè
                </button>
</div>
</div>
<!-- Right Panel: Big Timer -->
<div class="flex-grow flex flex-col items-center justify-center order-1 md:order-2">
<!-- Timer Circle -->
<div class="relative w-80 h-80 md:w-96 md:h-96 lg:w-[480px] lg:h-[480px] animate-float">
<svg class="w-full h-full drop-shadow-2xl" viewBox="0 0 120 120">
<circle class="text-white" cx="60" cy="60" fill="white" r="54"></circle>
<circle class="text-kawaii-secondary opacity-30" cx="60" cy="60" fill="transparent" r="54" stroke="currentColor" stroke-width="4"></circle>
<circle class="progress-ring__circle text-teal-400" cx="60" cy="60" fill="transparent" id="progress-ring" r="54" stroke="currentColor" stroke-linecap="round" stroke-width="4" style="stroke-dasharray: 339.292, 339.292; stroke-dashoffset: 334.768;"></circle>
</svg>
<div class="absolute inset-0 flex flex-col items-center justify-center">
<div class="text-teal-500 font-bold text-xl md:text-2xl mb-2 tracking-widest uppercase opacity-80" id="timer-label">BREAK</div>
<!-- Chime Status Message -->
<div class="text-teal-600 font-bold text-lg animate-pulse mb-2 hidden" id="chime-status">
<span class="material-symbols-rounded align-middle mr-1">notifications_active</span>
                        ‰ºëÊÜ©„ÅÆÊ∫ñÂÇô‰∏≠...
                    </div>
<div class="text-7xl md:text-8xl lg:text-9xl font-black text-kawaii-dark tracking-tighter tabular-nums leading-none mb-6" id="timer-display">04:56</div>
<div class="flex items-center justify-center gap-6">
<button class="w-14 h-14 bg-slate-100 text-kawaii-text rounded-full flex items-center justify-center shadow-md hover:bg-white hover:text-kawaii-primary transition-all group" onclick="restartTimer()" title="„É™„Çª„ÉÉ„Éà">
<span class="material-symbols-rounded text-2xl group-hover:rotate-180 transition-transform duration-500">refresh</span>
</button>
<button class="w-24 h-24 bg-gradient-to-br from-kawaii-primary to-kawaii-primaryDark text-white rounded-full flex items-center justify-center shadow-lg hover:scale-105 hover:shadow-xl transition-all" id="btn-main-action" onclick="toggleTimer()">
<span class="material-symbols-rounded text-6xl ml-2" id="icon-timer" style="display: block;">play_arrow</span>
</button>
</div>
<div class="absolute bottom-16 opacity-50 text-xs font-bold text-teal-600 bg-teal-50 px-3 py-1 rounded-full border border-teal-100" id="next-break-display" style="display: none;">Ê¨°Âõû„ÅÆ‰ºëÊÜ©: 5ÂàÜ</div>
</div>
</div>
</div>
</main>
<!-- Sound Drawer -->
<div class="fixed inset-y-0 right-0 w-80 sm:w-96 bg-white/95 backdrop-blur-xl shadow-2xl transform transition-transform duration-300 z-50 border-l border-white overflow-y-auto translate-x-full" id="sound-drawer">
<div class="p-6">
<div class="flex justify-between items-center mb-6">
<h2 class="text-xl font-extrabold text-kawaii-dark flex items-center gap-2">
<span class="material-symbols-rounded text-kawaii-primary">headphones</span>
                    Sound Mixer
                </h2>
<button class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center hover:bg-slate-200 text-slate-500 transition-colors" onclick="toggleSoundDrawer()">
<span class="material-symbols-rounded">close</span>
</button>
</div>
<!-- Chime Volume Control -->
<div class="bg-amber-50 p-4 rounded-2xl mb-6 border border-amber-100">
<div class="flex justify-between items-center mb-2">
<div class="flex items-center gap-3">
<div class="p-2 bg-amber-200 text-amber-700 rounded-xl">
<span class="material-symbols-rounded">school</span>
</div>
<div>
<div class="font-bold text-sm text-slate-700">Â≠¶Ê†°„ÅÆ„ÉÅ„É£„Ç§„É†</div>
<div class="text-[10px] text-slate-400">‰ºëÊÜ©ÈñãÂßã„ÅÆÂêàÂõ≥</div>
</div>
</div>
</div>
<input class="w-full h-1 bg-amber-200 rounded-lg appearance-none cursor-pointer accent-amber-500" id="chime-vol" max="0" min="-40" oninput="setChimeVolume(this.value)" type="range" value="-15">
</div>
<button class="w-full mb-8 py-3 rounded-2xl border-2 border-red-100 text-red-500 hover:bg-red-50 font-bold transition-all flex items-center justify-center gap-2 group" onclick="stopAllSounds()">
<span class="material-symbols-rounded group-hover:scale-110 transition-transform">stop_circle</span>
                ÂÖ®„Çµ„Ç¶„É≥„ÉâÂÅúÊ≠¢
            </button>
<div class="space-y-5">
            <div class="bg-slate-50 p-4 rounded-2xl hover:bg-white hover:shadow-md transition-all border border-transparent hover:border-amber-100">
                <div class="flex justify-between items-center mb-3">
                    <div class="flex items-center gap-3">
                        <div class="p-2 bg-amber-100 text-amber-600 rounded-xl">
                            <span class="material-symbols-rounded">waves</span>
                        </div>
                        <div>
                            <div class="font-bold text-sm text-slate-700">Brown Noise</div>
                            <div class="text-[10px] text-slate-400">Ê∑±„ÅÑÈõÜ‰∏≠„ÉªÈÅÆÈü≥</div>
                        </div>
                    </div>
                    <button id="btn-brown" onclick="toggleSound('brown')" class="w-10 h-10 rounded-full bg-white border border-slate-200 flex items-center justify-center text-slate-400 hover:text-kawaii-primary hover:border-kawaii-primary transition-all shadow-sm">
                        <span class="material-symbols-rounded">play_arrow</span>
                    </button>
                </div>
                <input type="range" id="vol-brown" min="-60" max="-10" value="-20" oninput="setVolume('brown', this.value)" disabled="" class="w-full h-1 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-kawaii-primary">
            </div>
        
            <div class="bg-slate-50 p-4 rounded-2xl hover:bg-white hover:shadow-md transition-all border border-transparent hover:border-pink-100">
                <div class="flex justify-between items-center mb-3">
                    <div class="flex items-center gap-3">
                        <div class="p-2 bg-pink-100 text-pink-600 rounded-xl">
                            <span class="material-symbols-rounded">water_drop</span>
                        </div>
                        <div>
                            <div class="font-bold text-sm text-slate-700">Pink Noise</div>
                            <div class="text-[10px] text-slate-400">„É™„É©„ÉÉ„ÇØ„Çπ„ÉªÂÆâ„Çâ„Åé</div>
                        </div>
                    </div>
                    <button id="btn-pink" onclick="toggleSound('pink')" class="w-10 h-10 rounded-full bg-white border border-slate-200 flex items-center justify-center text-slate-400 hover:text-kawaii-primary hover:border-kawaii-primary transition-all shadow-sm">
                        <span class="material-symbols-rounded">play_arrow</span>
                    </button>
                </div>
                <input type="range" id="vol-pink" min="-60" max="-10" value="-20" oninput="setVolume('pink', this.value)" disabled="" class="w-full h-1 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-kawaii-primary">
            </div>
        
            <div class="bg-slate-50 p-4 rounded-2xl hover:bg-white hover:shadow-md transition-all border border-transparent hover:border-blue-100">
                <div class="flex justify-between items-center mb-3">
                    <div class="flex items-center gap-3">
                        <div class="p-2 bg-blue-100 text-blue-600 rounded-xl">
                            <span class="material-symbols-rounded">rainy</span>
                        </div>
                        <div>
                            <div class="font-bold text-sm text-slate-700">Rain</div>
                            <div class="text-[10px] text-slate-400">Èõ®Èü≥„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥</div>
                        </div>
                    </div>
                    <button id="btn-rain" onclick="toggleSound('rain')" class="w-10 h-10 rounded-full bg-white border border-slate-200 flex items-center justify-center text-slate-400 hover:text-kawaii-primary hover:border-kawaii-primary transition-all shadow-sm">
                        <span class="material-symbols-rounded">play_arrow</span>
                    </button>
                </div>
                <input type="range" id="vol-rain" min="-60" max="-10" value="-20" oninput="setVolume('rain', this.value)" disabled="" class="w-full h-1 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-kawaii-primary">
            </div>
        
            <div class="bg-slate-50 p-4 rounded-2xl hover:bg-white hover:shadow-md transition-all border border-transparent hover:border-orange-100">
                <div class="flex justify-between items-center mb-3">
                    <div class="flex items-center gap-3">
                        <div class="p-2 bg-orange-100 text-orange-600 rounded-xl">
                            <span class="material-symbols-rounded">storefront</span>
                        </div>
                        <div>
                            <div class="font-bold text-sm text-slate-700">Cafe Vibe</div>
                            <div class="text-[10px] text-slate-400">ÈÅ©Â∫¶„Å™ÈõëÈü≥</div>
                        </div>
                    </div>
                    <button id="btn-cafe" onclick="toggleSound('cafe')" class="w-10 h-10 rounded-full bg-white border border-slate-200 flex items-center justify-center text-slate-400 hover:text-kawaii-primary hover:border-kawaii-primary transition-all shadow-sm">
                        <span class="material-symbols-rounded">play_arrow</span>
                    </button>
                </div>
                <input type="range" id="vol-cafe" min="-60" max="-10" value="-20" oninput="setVolume('cafe', this.value)" disabled="" class="w-full h-1 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-kawaii-primary">
            </div>
        
            <div class="bg-slate-50 p-4 rounded-2xl hover:bg-white hover:shadow-md transition-all border border-transparent hover:border-slate-100">
                <div class="flex justify-between items-center mb-3">
                    <div class="flex items-center gap-3">
                        <div class="p-2 bg-slate-100 text-slate-600 rounded-xl">
                            <span class="material-symbols-rounded">air</span>
                        </div>
                        <div>
                            <div class="font-bold text-sm text-slate-700">White Noise</div>
                            <div class="text-[10px] text-slate-400">„Éá„Ç∏„Çø„É´ÈÅÆÊñ≠</div>
                        </div>
                    </div>
                    <button id="btn-white" onclick="toggleSound('white')" class="w-10 h-10 rounded-full bg-white border border-slate-200 flex items-center justify-center text-slate-400 hover:text-kawaii-primary hover:border-kawaii-primary transition-all shadow-sm">
                        <span class="material-symbols-rounded">play_arrow</span>
                    </button>
                </div>
                <input type="range" id="vol-white" min="-60" max="-10" value="-20" oninput="setVolume('white', this.value)" disabled="" class="w-full h-1 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-kawaii-primary">
            </div>
        </div>
</div>
</div>
<div class="fixed inset-0 bg-black/20 backdrop-blur-sm z-40 transition-opacity opacity-0 hidden" id="drawer-overlay" onclick="toggleSoundDrawer()"></div>
<!-- RSVP Modal -->
<div class="fixed inset-0 z-50 hidden flex items-center justify-center bg-kawaii-dark/40 backdrop-blur-sm p-4 transition-all" id="rsvp-modal">
<div class="bg-white rounded-[2rem] w-full max-w-2xl max-h-[90vh] overflow-y-auto p-6 md:p-8 shadow-2xl relative">
<button class="absolute top-4 right-4 w-10 h-10 rounded-full bg-slate-100 hover:bg-slate-200 flex items-center justify-center text-slate-500 transition-colors" onclick="document.getElementById('rsvp-modal').classList.add('hidden')">
<span class="material-symbols-rounded">close</span>
</button>
<div class="flex items-center gap-3 mb-6">
<span class="material-symbols-rounded text-green-500 text-3xl">speed</span>
<h2 class="text-2xl font-bold text-kawaii-dark">Áû¨Ë™≠„Éà„É¨„Éº„Éä„Éº</h2>
</div>
<div class="grid gap-6">
<div class="h-48 bg-slate-900 rounded-2xl flex flex-col items-center justify-center relative overflow-hidden shadow-inner ring-4 ring-slate-100">
<div class="absolute top-0 bottom-0 w-px bg-white/10 left-1/2 transform -translate-x-1/2"></div>
<div class="absolute left-0 right-0 h-px bg-white/10 top-1/2 transform -translate-y-1/2"></div>
<div class="text-4xl md:text-5xl font-bold text-white tracking-wide text-center px-4" id="rsvp-display" style="font-feature-settings: 'palt'">Ready?</div>
</div>
<div class="space-y-4">
<textarea class="w-full p-4 text-sm border-2 border-slate-100 rounded-xl bg-slate-50 resize-none h-32 focus:border-green-300 focus:bg-white outline-none transition-all" id="rsvp-input" placeholder="„Åì„Åì„Å´Ë™≠„Åø„Åü„ÅÑÊñáÁ´†„ÇíË≤º„Çä‰ªò„Åë„Å¶„Åè„Å†„Åï„ÅÑ..."></textarea>
<div class="flex flex-col sm:flex-row items-center gap-4 bg-slate-50 p-4 rounded-xl">
<span class="text-sm font-bold text-slate-500 whitespace-nowrap">ÈÄüÂ∫¶ (WPM): <span class="text-green-600 text-lg" id="wpm-val">400</span></span>
<input class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-green-500" id="rsvp-speed" max="1200" min="200" oninput="document.getElementById('wpm-val').innerText = this.value" step="50" type="range" value="400">
</div>
<div class="flex gap-3">
<button class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-3 rounded-xl shadow-md transition-all flex items-center justify-center gap-2" onclick="startRSVP()">
<span class="material-symbols-rounded">play_circle</span> „Çπ„Çø„Éº„Éà
                        </button>
<button class="px-6 py-3 bg-white border-2 border-slate-100 hover:bg-slate-50 rounded-xl text-sm font-bold text-slate-600 transition-all" onclick="fillSampleText()">„Çµ„É≥„Éó„É´</button>
</div>
</div>
</div>
</div>
</div>
<script>
        // --- Timer State ---
        let timerInterval;
        let timeLeft = 25 * 60;
        let totalTime = 25 * 60;
        let isRunning = false;
        let completedCount = 0;
        let currentBreakTime = 5; // Default break time
        let chimeVolume = -15; // Default Chime Volume
        let audioReady = false;
        async function ensureAudio() {
            if (!audioReady) {
                await await ensureAudio();
                audioReady = true;
            }
        }
        
        // --- UI Elements ---
        const timerDisplay = document.getElementById('timer-display');
        const timerLabel = document.getElementById('timer-label');
        const progressCircle = document.getElementById('progress-ring');
        const playIcon = document.getElementById('icon-timer');
        const countDisplay = document.getElementById('complete-count');
        const nextBreakDisplay = document.getElementById('next-break-display');
        const chimeStatus = document.getElementById('chime-status');
        const btnMainAction = document.getElementById('btn-main-action');

        // Circular Progress Setup
        const radius = progressCircle.r.baseVal.value;
        const circumference = radius * 2 * Math.PI;
        progressCircle.style.strokeDasharray = `${circumference} ${circumference}`;
        progressCircle.style.strokeDashoffset = 0;

        // Render Sounds
        const soundsData = [
            {id: 'brown', name: 'Brown Noise', desc: 'Ê∑±„ÅÑÈõÜ‰∏≠„ÉªÈÅÆÈü≥', icon: 'waves', color: 'amber'},
            {id: 'pink', name: 'Pink Noise', desc: '„É™„É©„ÉÉ„ÇØ„Çπ„ÉªÂÆâ„Çâ„Åé', icon: 'water_drop', color: 'pink'},
            {id: 'rain', name: 'Rain', desc: 'Èõ®Èü≥„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥', icon: 'rainy', color: 'blue'},
            {id: 'cafe', name: 'Cafe Vibe', desc: 'ÈÅ©Â∫¶„Å™ÈõëÈü≥', icon: 'storefront', color: 'orange'},
            {id: 'white', name: 'White Noise', desc: '„Éá„Ç∏„Çø„É´ÈÅÆÊñ≠', icon: 'air', color: 'slate'},
        ];
        document.querySelector('#sound-drawer .space-y-5').innerHTML = soundsData.map(s => `
            <div class="bg-slate-50 p-4 rounded-2xl hover:bg-white hover:shadow-md transition-all border border-transparent hover:border-${s.color}-100">
                <div class="flex justify-between items-center mb-3">
                    <div class="flex items-center gap-3">
                        <div class="p-2 bg-${s.color}-100 text-${s.color}-600 rounded-xl">
                            <span class="material-symbols-rounded">${s.icon}</span>
                        </div>
                        <div>
                            <div class="font-bold text-sm text-slate-700">${s.name}</div>
                            <div class="text-[10px] text-slate-400">${s.desc}</div>
                        </div>
                    </div>
                    <button id="btn-${s.id}" onclick="toggleSound('${s.id}')" 
                        class="w-10 h-10 rounded-full bg-white border border-slate-200 flex items-center justify-center text-slate-400 hover:text-kawaii-primary hover:border-kawaii-primary transition-all shadow-sm">
                        <span class="material-symbols-rounded">play_arrow</span>
                    </button>
                </div>
                <input type="range" id="vol-${s.id}" min="-60" max="-10" value="-20" oninput="setVolume('${s.id}', this.value)" disabled
                    class="w-full h-1 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-kawaii-primary">
            </div>
        `).join('');

        function setProgress(percent) {
            const offset = circumference - (percent / 100) * circumference;
            progressCircle.style.strokeDashoffset = offset;
        }

        function updateDisplay() {
            const m = Math.floor(timeLeft / 60);
            const s = timeLeft % 60;
            timerDisplay.innerText = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
            document.title = isRunning ? `(${m}:${s}) Focus Studio` : 'Focus Studio';
            const percent = ((totalTime - timeLeft) / totalTime) * 100;
            setProgress(percent);
            
            if(timerLabel.innerText === 'BREAK') {
                nextBreakDisplay.style.display = 'none';
            } else {
                nextBreakDisplay.style.display = 'block';
                nextBreakDisplay.innerText = `Ê¨°Âõû„ÅÆ‰ºëÊÜ©: ${currentBreakTime}ÂàÜ`;
            }
        }

        // Apply Preset (Both Focus and Break)
        function applyPreset(focusMin, breakMin, btnElement) {
            setTimer(breakMin, 'break', true);
            setTimer(focusMin, 'focus');
            document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('preset-btn-active'));
            if(btnElement) btnElement.classList.add('preset-btn-active');
        }

        function setTimer(minutes, mode, isPreferenceOnly = false) {
            if (mode === 'break') {
                currentBreakTime = minutes;
                updateBreakButtons(minutes);
                if (timerLabel.innerText === 'BREAK') {
                    clearInterval(timerInterval);
                    isRunning = false;
                    playIcon.innerText = 'play_arrow';
                    timeLeft = minutes * 60;
                    totalTime = timeLeft;
                    updateDisplay();
                }
                return;
            }

            // Focus Mode
            clearInterval(timerInterval);
            isRunning = false;
            playIcon.innerText = 'play_arrow';
            
            timeLeft = minutes * 60;
            totalTime = timeLeft;
            
            updateFocusButtons(minutes);
            document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('preset-btn-active'));

            timerLabel.innerText = 'FOCUS';
            timerLabel.className = 'text-kawaii-primary font-bold text-xl md:text-2xl mb-2 tracking-widest uppercase opacity-80';
            progressCircle.classList.remove('text-teal-400');
            progressCircle.classList.add('text-kawaii-primary');
            progressCircle.style.strokeDashoffset = 0;
            
            // Hide chime status
            chimeStatus.classList.add('hidden');
            timerDisplay.classList.remove('opacity-20');
            playIcon.style.display = 'block';
            
            updateDisplay();
        }

        function updateFocusButtons(minutes) {
             document.querySelectorAll('.timer-preset').forEach(btn => {
                if (!btn.innerText.includes('ÂàÜ')) {
                    btn.classList.remove('timer-btn-active', 'bg-kawaii-primary', 'text-white', 'shadow-lg', 'scale-105');
                    btn.classList.add('bg-white', 'text-kawaii-text');
                    if(btn.innerText.trim() == minutes.toString()) {
                         btn.classList.remove('bg-white', 'text-kawaii-text');
                         btn.classList.add('timer-btn-active', 'bg-kawaii-primary', 'text-white', 'shadow-lg', 'scale-105');
                    }
                }
            });
        }

        function updateBreakButtons(minutes) {
            document.querySelectorAll('.timer-preset').forEach(btn => {
                if (btn.innerText.includes('ÂàÜ')) {
                    btn.classList.remove('break-btn-active', 'bg-kawaii-accent', 'scale-105', 'shadow-md');
                    btn.classList.add('bg-kawaii-accent/40');
                    if(btn.innerText.replace('ÂàÜ','').trim() == minutes.toString()) {
                        btn.classList.remove('bg-kawaii-accent/40');
                        btn.classList.add('break-btn-active', 'bg-kawaii-accent', 'scale-105', 'shadow-md');
                    }
                }
            });
        }

        async function toggleTimer() {
            if (isRunning) {
                clearInterval(timerInterval);
                isRunning = false;
                playIcon.innerText = 'play_arrow';
            } else {
                await ensureAudio();
                if (timeLeft <= 0) timeLeft = totalTime;
                isRunning = true;
                playIcon.innerText = 'pause';
                
                timerInterval = setInterval(() => {
                    if (timeLeft > 0) {
                        timeLeft--;
                        updateDisplay();
                    } else {
                        completeTimer();
                    }
                }, 1000);
            }
        }

        function restartTimer() {
            clearInterval(timerInterval);
            isRunning = false;
            playIcon.innerText = 'play_arrow';
            timeLeft = totalTime;
            chimeStatus.classList.add('hidden');
            timerDisplay.classList.remove('opacity-20');
            playIcon.style.display = 'block';
            updateDisplay();
        }

        async function completeTimer() {
            clearInterval(timerInterval);
            isRunning = false;
            playIcon.innerText = 'play_arrow';
            
            if (timerLabel.innerText === 'FOCUS') {
                completedCount++;
                countDisplay.innerText = completedCount;
                
                // Play School Chime and transition
                await playSchoolChimeAndStartBreak();
                
            } else {
                // Break ended
                await ensureAudio();
                const synth = new Tone.Synth().toDestination();
                synth.triggerAttackRelease("G4", "0.5");
                alert("‰ºëÊÜ©ÁµÇ‰∫ÜÔºÅÊ¨°„ÅÆÈõÜ‰∏≠„Çø„Ç§„É†„ÇíÂßã„ÇÅ„Åæ„Åó„Çá„ÅÜüí™");
            }
        }

        function setChimeVolume(val) {
            chimeVolume = parseInt(val);
        }

        // --- School Chime Logic ---
        async function playSchoolChimeAndStartBreak() {
            // UI State for "Chime/Buffer Time"
            chimeStatus.classList.remove('hidden');
            timerDisplay.classList.add('opacity-20');
            playIcon.style.display = 'none'; // Hide play button during chime
            await ensureAudio();
            
            // Tone.js Chime (Westminster Quarters approximate)
            const synth = new Tone.Synth({
                oscillator: { type: "triangle" },
                envelope: { attack: 0.05, decay: 0.2, sustain: 0.2, release: 2 }
            }).toDestination();
            
            // Apply volume
            synth.volume.value = chimeVolume;
            
            // Add a little reverb
            const reverb = new Tone.Reverb({ decay: 3, wet: 0.3 }).toDestination();
            synth.connect(reverb);

            const now = Tone.now();
            // Phrase 1: Kin-Kon-Kan-Kon (E-C-D-G)
            synth.triggerAttackRelease("E5", "0.8", now);
            synth.triggerAttackRelease("C5", "0.8", now + 1);
            synth.triggerAttackRelease("D5", "0.8", now + 2);
            synth.triggerAttackRelease("G4", "1.5", now + 3);

            // Phrase 2: Kon-Kan-Kin-Kon (G-D-E-C) (Pause ~1.5s after first phrase)
            const phrase2 = now + 6.0;
            synth.triggerAttackRelease("G4", "0.8", phrase2);
            synth.triggerAttackRelease("D5", "0.8", phrase2 + 1);
            synth.triggerAttackRelease("E5", "0.8", phrase2 + 2);
            synth.triggerAttackRelease("C5", "2.0", phrase2 + 3);

            // Wait until full melody + decay finishes before starting break
            // Melody ends around 11s. Decay takes it to ~13s.
            setTimeout(() => {
                startBreakMode();
            }, 14000); 
        }

        function startBreakMode() {
            // Restore UI
            chimeStatus.classList.add('hidden');
            timerDisplay.classList.remove('opacity-20');
            playIcon.style.display = 'block';
            
            // Switch Mode logic
            timerLabel.innerText = 'BREAK';
            timerLabel.className = 'text-teal-500 font-bold text-xl md:text-2xl mb-2 tracking-widest uppercase opacity-80';
            progressCircle.classList.remove('text-kawaii-primary');
            progressCircle.classList.add('text-teal-400');
            
            timeLeft = currentBreakTime * 60;
            totalTime = timeLeft;
            updateDisplay();
            
            // Auto-start
            toggleTimer();
        }


        // --- Sound Logic ---
        const sounds = {};
        async function toggleSound(type) {
            await ensureAudio();
            const btn = document.getElementById(`btn-${type}`);
            const slider = document.getElementById(`vol-${type}`);
            if (sounds[type]) {
                sounds[type].stop(); sounds[type].dispose(); delete sounds[type];
                btn.innerHTML = '<span class="material-symbols-rounded">play_arrow</span>';
                btn.classList.remove('bg-kawaii-primary', 'text-white', 'border-transparent');
                btn.classList.add('bg-white', 'text-slate-400', 'border-slate-200');
                slider.disabled = true;
            } else {
                let node;
                if (type === 'rain') {
                    const noise = new Tone.Noise("pink").start();
                    const filter = new Tone.AutoFilter(1, 400).toDestination().start();
                    noise.connect(filter);
                    node = { volume: noise.volume, stop:()=>{noise.stop();filter.stop();}, dispose:()=>{noise.dispose();filter.dispose();} };
                } else if (type === 'cafe') {
                    const noise = new Tone.Noise("brown").start();
                    const filter = new Tone.Filter(800, "lowpass").toDestination();
                    const lfo = new Tone.LFO(0.5, 400, 1000).start();
                    lfo.connect(filter.frequency);
                    noise.connect(filter);
                    node = { volume: noise.volume, stop:()=>{noise.stop();lfo.stop();}, dispose:()=>{noise.dispose();lfo.dispose();filter.dispose();} };
                } else {
                    node = new Tone.Noise(type).toDestination().start();
                }
                node.volume.value = parseInt(slider.value);
                sounds[type] = node;
                btn.innerHTML = '<span class="material-symbols-rounded">pause</span>';
                btn.classList.remove('bg-white', 'text-slate-400', 'border-slate-200');
                btn.classList.add('bg-kawaii-primary', 'text-white', 'border-transparent');
                slider.disabled = false;
            }
            updateSoundBadge();
        }
        function setVolume(type, val) { if (sounds[type]) sounds[type].volume.rampTo(parseInt(val), 0.1); }
        function stopAllSounds() { Object.keys(sounds).forEach(k => toggleSound(k)); }
        function updateSoundBadge() { document.getElementById('sound-badge').style.display = Object.keys(sounds).length > 0 ? 'block' : 'none'; }
        function toggleSoundDrawer() {
            const d = document.getElementById('sound-drawer'), o = document.getElementById('drawer-overlay');
            if (d.classList.contains('translate-x-full')) { d.classList.remove('translate-x-full'); o.classList.remove('hidden'); setTimeout(()=>o.classList.remove('opacity-0'),10); }
            else { d.classList.add('translate-x-full'); o.classList.add('opacity-0'); setTimeout(()=>o.classList.add('hidden'),300); }
        }
        function downloadApp() {
            const blob = new Blob([document.documentElement.outerHTML], {type: 'text/html'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'KawaiiFocus.html';
            a.click();
        }

        // --- RSVP Logic ---
        let rsvpInterval;
        function startRSVP() {
            const text = document.getElementById('rsvp-input').value;
            if(!text) return;
            const words = text.split('').reduce((acc, c) => {
                if(acc.length && acc[acc.length-1].length < 4 && !['„ÄÅ','„ÄÇ'].includes(acc[acc.length-1].slice(-1))) acc[acc.length-1]+=c;
                else acc.push(c);
                return acc;
            }, []);
            let i = 0;
            const ms = 60000 / parseInt(document.getElementById('rsvp-speed').value);
            const display = document.getElementById('rsvp-display');
            clearInterval(rsvpInterval);
            rsvpInterval = setInterval(() => {
                if(i >= words.length) { clearInterval(rsvpInterval); return; }
                display.innerText = words[i++];
            }, ms);
        }
        function fillSampleText() {
            document.getElementById('rsvp-input').value = "„Åì„ÅÆ„ÉÑ„Éº„É´„ÅØ„ÄÅÊñáÁ´†„ÇíÈ´òÈÄü„ÅßË°®Á§∫„Åô„Çã„Åì„Å®„Åß„ÄÅÁúºÁêÉÁßªÂãï„ÇíÊäë„Åà„ÄÅËÑ≥„ÅÆÂá¶ÁêÜÈÄüÂ∫¶„ÇíÂêë‰∏ä„Åï„Åõ„Çã„Éà„É¨„Éº„Éã„É≥„Ç∞„ÉÑ„Éº„É´„Åß„Åô„ÄÇ";
        }

        // Init: Set Default Timer
        updateDisplay();
    </script>

</body></html>
